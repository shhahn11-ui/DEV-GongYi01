<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TodoShare - ë¦¬ìŠ¤íŠ¸ ê³µìœ </title>
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="favicon.png">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header>
    <nav class="container">
      <div class="logo">ğŸ“‹ TodoShare</div>
      <button class="hamburger-menu" id="hamburgerBtn">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="nav-menu" id="navMenu"></ul>
    </nav>
  </header>

  <main class="container main-content">
    <h1 class="page-title">ğŸŒŸ ê³µìœ ëœ íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸</h1>

    <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
      <button class="btn" id="openUploadBtn">ì—…ë¡œë“œ</button>
      <button class="btn btn-secondary" id="cancelUploadBtn" style="display: none;">ë‹«ê¸°</button>
    </div>

    <div id="uploadForm" style="display: none; margin-bottom: 1.5rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; background: #fafafa;">
      <div class="form-group">
        <label for="shareTitle">ì œëª©</label>
        <input type="text" id="shareTitle" placeholder="ì˜ˆ: ì•„ì¹¨ ë£¨í‹´ ì²´í¬ë¦¬ìŠ¤íŠ¸" required>
      </div>

      <div class="form-group">
        <label>ë¦¬ìŠ¤íŠ¸ í•­ëª©</label>
        <div id="itemsContainer" style="display: flex; flex-direction: column; gap: 0.5rem;">
          <div class="item-row share-item-row">
            <input type="text" class="share-item" placeholder="í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            <select class="share-item-category" required>
              <option value="">ì¹´í…Œê³ ë¦¬</option>
              <option value="ê±´ê°•">ê±´ê°•</option>
              <option value="ê³µë¶€">ê³µë¶€</option>
              <option value="í—¬ìŠ¤">í—¬ìŠ¤</option>
              <option value="ì¼">ì¼</option>
              <option value="ì·¨ë¯¸">ì·¨ë¯¸</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>
        </div>
        <button class="btn btn-secondary" id="addItemBtn" type="button" style="margin-top: 0.5rem;">í•­ëª© ì¶”ê°€</button>
      </div>

      <div class="form-group">
        <label for="shareCategory">ì¹´í…Œê³ ë¦¬</label>
        <select id="shareCategory" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; background: #fff; font-size: 0.95rem; appearance: none;">
          <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
          <option value="ê±´ê°•">ê±´ê°•</option>
          <option value="ê³µë¶€">ê³µë¶€</option>
          <option value="í—¬ìŠ¤">í—¬ìŠ¤</option>
          <option value="ì¼">ì¼</option>
          <option value="ì·¨ë¯¸">ì·¨ë¯¸</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>
      </div>

      <button class="btn" id="submitShareBtn" type="button">ì œì¶œ</button>
      <div id="uploadStatus" style="margin-top: 0.5rem; font-size: 0.95rem; color: #666;"></div>
    </div>

    <div class="todo-section">
      <div class="category-filter">
        <button class="category-btn active" data-category="">ì „ì²´</button>
        <button class="category-btn" data-category="ê±´ê°•">ê±´ê°•</button>
        <button class="category-btn" data-category="ê³µë¶€">ê³µë¶€</button>
        <button class="category-btn" data-category="í—¬ìŠ¤">í—¬ìŠ¤</button>
        <button class="category-btn" data-category="ì¼">ì¼</button>
        <button class="category-btn" data-category="ì·¨ë¯¸">ì·¨ë¯¸</button>
        <button class="category-btn" data-category="ê¸°íƒ€">ê¸°íƒ€</button>
      </div>

      <div class="leaderboard" style="margin-top: 1rem;">
        <div class="leaderboard-header">
          <div>
            <div class="leaderboard-label">ğŸ”¥ ë­í‚¹</div>
            <h2 class="leaderboard-title">Top 10 í”Œë ˆì´ì–´</h2>
          </div>
          <button class="btn btn-secondary" id="refreshLeaderboardBtn" type="button">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div id="leaderboardTop3" class="leaderboard-top3"></div>
        <div id="leaderboardEmpty" class="leaderboard-empty" style="display: none;">ì•„ì§ ë­í‚¹ì— í‘œì‹œí•  ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        <ul id="leaderboardList" class="leaderboard-list"></ul>
      </div>

      <div class="shared-lists-container" id="sharedListsContainer">
        <div style="text-align: center; padding: 2rem; color: #999; grid-column: 1/-1;">
          ğŸ“­ ê³µìœ ëœ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    import { getCurrentUser, onAuthChange, getUserInfo } from './js/auth.js';
    import { initializeHeader, enforceAuthPage } from './js/header.js';
    import { db } from './js/firebase-config.js';
    import {
      addDoc,
      collection,
      getDocs,
      updateDoc,
      deleteDoc,
      doc,
      query,
      where,
      orderBy,
      Timestamp,
      increment,
      limit
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    let currentUser = null;
    let sharedTodos = [];
    let currentFilter = '';
    let uploading = false;

    // ì¸ì¦ ìƒíƒœ ëª¨ë‹ˆí„°ë§
    onAuthChange(user => {
      currentUser = user;
      if (user) {
        initializeHeader();
        loadSharedTodos();
        setupHamburgerMenu();
        loadLeaderboard();
      } else {
        window.location.href = 'index.html';
      }
    });

    enforceAuthPage('index.html');

    const sharedListsContainer = document.getElementById('sharedListsContainer');
    const categoryButtons = document.querySelectorAll('.category-btn');
    const openUploadBtn = document.getElementById('openUploadBtn');
    const cancelUploadBtn = document.getElementById('cancelUploadBtn');
    const uploadForm = document.getElementById('uploadForm');
    const shareTitle = document.getElementById('shareTitle');
    const shareCategory = document.getElementById('shareCategory');
    const addItemBtn = document.getElementById('addItemBtn');
    const itemsContainer = document.getElementById('itemsContainer');
    const submitShareBtn = document.getElementById('submitShareBtn');
    const uploadStatus = document.getElementById('uploadStatus');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const navMenu = document.getElementById('navMenu');
    const leaderboardList = document.getElementById('leaderboardList');
    const leaderboardEmpty = document.getElementById('leaderboardEmpty');
    const leaderboardTop3 = document.getElementById('leaderboardTop3');
    const refreshLeaderboardBtn = document.getElementById('refreshLeaderboardBtn');
    refreshLeaderboardBtn.addEventListener('click', loadLeaderboard);

    // ë¡œì»¬ íƒ€ì„ì¡´ ê¸°ì¤€ YYYY-MM-DD ë¬¸ìì—´
    function formatLocalDate(daysOffset = 0) {
      const date = new Date();
      date.setDate(date.getDate() + daysOffset);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // ê³µìœ ëœ í• ì¼ ë¡œë“œ
    function titleForLevel(level) {
      if (level >= 50) return 'ê±°ì˜ CEO';
      if (level >= 33) return 'ì˜ˆë¹„ CEO';
      if (level >= 25) return 'ìƒì‚°ì„± ë§ˆìŠ¤í„°';
      if (level >= 18) return 'ì‹œê°„ ì „ëµê°€';
      if (level >= 13) return 'ìŠµê´€ ì¥ì¸';
      if (level >= 9) return 'ëª©í‘œ ë‹¬ì„±ê°€';
      if (level >= 6) return 'ëª°ì…í˜• í¼í¬ë¨¸';
      if (level >= 4) return 'ì„±ì¥í•˜ëŠ” í”Œë˜ë„ˆ';
      if (level >= 2) return 'ê¾¸ì¤€í•œ ì‹¤í–‰ê°€';
      return 'ìƒˆì‹¹ ë„ì „ì';
    }

    async function loadSharedTodos() {
      try {
        const q = query(
          collection(db, 'sharedLists'),
          orderBy('likes', 'desc'),
          orderBy('createdAt', 'desc')
        );

        const snapshot = await getDocs(q);
        sharedTodos = await Promise.all(snapshot.docs.map(async (doc) => {
          const data = doc.data();
          // ì‘ì„±ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const userInfo = await getUserInfo(data.uid);
          const level = data.level ?? userInfo?.level ?? 1;
          return {
            id: doc.id,
            ...data,
            nickname: userInfo?.nickname || 'ìµëª…ì˜ ì‚¬ìš©ì',
            level,
            titleName: data.titleName || titleForLevel(level),
            importCount: data.importCount || 0
          };
        }));

        renderSharedTodos();
      } catch (error) {
        console.error('ê³µìœ  í• ì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ê³µìœ ëœ í• ì¼ ë Œë”ë§
    function renderSharedTodos() {
      const filteredTodos = currentFilter
        ? sharedTodos.filter(todo => todo.category === currentFilter)
        : sharedTodos;

      const today = formatLocalDate();

      if (filteredTodos.length === 0) {
        sharedListsContainer.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: #999; grid-column: 1/-1;">
            ğŸ“­ ${currentFilter ? 'ì´ ì¹´í…Œê³ ë¦¬ì— ê³µìœ ëœ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'ê³µìœ ëœ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.'}
          </div>
        `;
        return;
      }

      sharedListsContainer.innerHTML = filteredTodos.map(todo => {
        return `
          <div class="todo-card">
            <div class="todo-card-header">
              <div class="todo-card-title">${todo.title || todo.text}</div>
              <span class="todo-card-category">${todo.category}</span>
            </div>
            <div class="todo-card-meta">
              <span class="todo-card-author">ğŸ‘¤ ${todo.nickname} Â· ${todo.titleName || titleForLevel(todo.level || 1)}</span>
            </div>
            <div class="todo-card-meta">ì¹­í˜¸: ${todo.titleName || titleForLevel(todo.level || 1)}</div>
            <div class="todo-card-meta">ë¶ˆëŸ¬ì˜¨ íšŸìˆ˜: ${todo.importCount || 0}</div>
            <div class="todo-card-meta import-date-row">
              <span class="import-date-label">ğŸ“… ë¶ˆëŸ¬ì˜¬ ë‚ ì§œ</span>
              <input type="date" class="import-date" data-id="${todo.id}" value="${today}">
            </div>
            <ul class="todo-list shared-items-list">
              ${(todo.items || []).map(item => {
                const text = typeof item === 'string' ? item : (item?.text || '');
                const cat = typeof item === 'object' ? (item?.category || '') : '';
                return `<li class="shared-item-row">${text ? text : ''}${cat ? `<span class="shared-item-cat">${cat}</span>` : ''}</li>`;
              }).join('')}
            </ul>
            <div class="todo-card-actions">
              <button class="btn-small btn-like" data-id="${todo.id}" data-likes="${todo.likes || 0}">
                ğŸ’š ì¢‹ì•„ìš” ${todo.likes || 0}
              </button>
              <button class="btn-small btn-import" data-id="${todo.id}">ë¶ˆëŸ¬ì˜¤ê¸°</button>
              ${currentUser && currentUser.uid === todo.uid ? `<button class="btn-small btn-delete" data-id="${todo.id}">ì‚­ì œ</button>` : ''}
            </div>
          </div>
        `;
      }).join('');

      // ì•¡ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ë°”ì¸ë”©
      document.querySelectorAll('.btn-like').forEach(btn => {
        btn.addEventListener('click', () => likeTodo(btn.dataset.id, Number(btn.dataset.likes || 0)));
      });

      document.querySelectorAll('.btn-import').forEach(btn => {
        btn.addEventListener('click', () => importSharedList(btn.dataset.id));
      });

      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', () => deleteSharedList(btn.dataset.id));
      });
    }

    // ì¢‹ì•„ìš” ì¦ê°€ (ì‚¬ìš©ìë‹¹ 1íšŒ, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¡œ í´ë¼ì´ì–¸íŠ¸ ì œí•œ)
    async function likeTodo(id, currentLikes) {
      if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      const key = `liked_sharedLists_${currentUser.uid}`;
      const liked = new Set(JSON.parse(localStorage.getItem(key) || '[]'));
      if (liked.has(id)) {
        alert('ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì…¨ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        const nextLikes = (currentLikes || 0) + 1;
        await updateDoc(doc(db, 'sharedLists', id), {
          likes: nextLikes
        });
        liked.add(id);
        localStorage.setItem(key, JSON.stringify(Array.from(liked)));
        await loadSharedTodos();
      } catch (error) {
        console.error('ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
      }
    }

    // ê³µìœ  ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -> ê°œì¸ todosì— ì¶”ê°€, importCount ì¦ê°€
    async function importSharedList(id) {
      if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      const target = sharedTodos.find(t => t.id === id);
      if (!target) return;

      const dateInput = document.querySelector(`.import-date[data-id="${id}"]`);
      const dueDate = dateInput?.value || '';

      const items = target.items || [];
      if (items.length === 0) {
        alert('ë¶ˆëŸ¬ì˜¬ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        // ì‚¬ìš©ì todosì— í•­ëª© ì¶”ê°€
        const batchPromises = items.map(text => addDoc(collection(db, 'todos'), {
          uid: currentUser.uid,
          text,
          category: target.category || '',
          dueDate,
          completed: false,
          completedDate: null,
          createdAt: Timestamp.now(),
          shared: false,
          sourceSharedId: target.id,
          sourceTitle: target.title
        }));

        await Promise.all(batchPromises);

        // importCount ì¦ê°€
        await updateDoc(doc(db, 'sharedLists', id), {
          importCount: increment(1)
        });

        await loadSharedTodos();
        alert('ë‚´ ë¦¬ìŠ¤íŠ¸ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
        alert('ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê²Œì‹œì ì‚­ì œ
    async function deleteSharedList(id) {
      if (!currentUser) return;
      if (!confirm('ì´ ê³µìœ  ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        await deleteDoc(doc(db, 'sharedLists', id));
        await loadSharedTodos();
      } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
      }
    }

    function resetUploadForm() {
      shareTitle.value = '';
      shareCategory.value = '';
      itemsContainer.innerHTML = '<div class="item-row"><input type="text" class="share-item" placeholder="í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required></div>';
      uploadForm.style.display = 'none';
      cancelUploadBtn.style.display = 'none';
      openUploadBtn.style.display = 'inline-flex';
      uploadStatus.textContent = '';
    }

    async function submitSharedList() {
      if (uploading) return;
      if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      const title = shareTitle.value.trim();
      const category = shareCategory.value.trim();
      const items = Array.from(document.querySelectorAll('.share-item-row')).map(row => {
        const text = row.querySelector('.share-item')?.value.trim() || '';
        const itemCategory = row.querySelector('.share-item-category')?.value.trim() || '';
        return { text, category: itemCategory };
      }).filter(item => item.text && item.category);

      if (!title) {
        uploadStatus.textContent = 'ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.';
        uploadStatus.style.color = '#d9534f';
        return;
      }

      if (items.length === 0) {
        uploadStatus.textContent = 'ë¦¬ìŠ¤íŠ¸ í•­ëª©ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.';
        uploadStatus.style.color = '#d9534f';
        return;
      }

      if (!category) {
        uploadStatus.textContent = 'ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
        uploadStatus.style.color = '#d9534f';
        return;
      }

      uploading = true;
      submitShareBtn.disabled = true;
      uploadStatus.textContent = 'ì—…ë¡œë“œ ì¤‘...';
      uploadStatus.style.color = '#666';

      try {
        const userInfo = await getUserInfo(currentUser.uid);
        const level = userInfo?.level ?? 1;
        const titleName = titleForLevel(level);

        await addDoc(collection(db, 'sharedLists'), {
          uid: currentUser.uid,
          title,
          items,
          category,
          likes: 0,
          importCount: 0,
          createdAt: Timestamp.now(),
          level,
          titleName,
          nickname: userInfo?.nickname || 'ìµëª…ì˜ ì‚¬ìš©ì'
        });

        uploadStatus.textContent = 'ì—…ë¡œë“œ ì™„ë£Œ!';
        uploadStatus.style.color = '#28a745';
        resetUploadForm();
        await loadSharedTodos();
      } catch (error) {
        console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        uploadStatus.textContent = 'ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message;
        uploadStatus.style.color = '#d9534f';
      } finally {
        uploading = false;
        submitShareBtn.disabled = false;
      }
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    categoryButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        categoryButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.category;
        renderSharedTodos();
      });
    });

    // ì—…ë¡œë“œ ì˜ì—­ í† ê¸€
    openUploadBtn.addEventListener('click', () => {
      uploadForm.style.display = 'block';
      cancelUploadBtn.style.display = 'inline-flex';
      openUploadBtn.style.display = 'none';
    });

    cancelUploadBtn.addEventListener('click', () => {
      resetUploadForm();
    });

    addItemBtn.addEventListener('click', () => {
      const div = document.createElement('div');
      div.className = 'item-row share-item-row';
      div.innerHTML = `
        <input type="text" class="share-item" placeholder="í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        <select class="share-item-category" required>
          <option value="">ì¹´í…Œê³ ë¦¬</option>
          <option value="ê±´ê°•">ê±´ê°•</option>
          <option value="ê³µë¶€">ê³µë¶€</option>
          <option value="í—¬ìŠ¤">í—¬ìŠ¤</option>
          <option value="ì¼">ì¼</option>
          <option value="ì·¨ë¯¸">ì·¨ë¯¸</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>
      `;
      itemsContainer.appendChild(div);
    });

    submitShareBtn.addEventListener('click', submitSharedList);
    function setupHamburgerMenu() {
      if (!hamburgerBtn || !navMenu) return;

      hamburgerBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        hamburgerBtn.classList.toggle('active');
        navMenu.classList.toggle('active');
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('header')) {
          hamburgerBtn.classList.remove('active');
          navMenu.classList.remove('active');
        }
      });
    }

    async function loadLeaderboard() {
      try {
        const q = query(collection(db, 'users'), orderBy('xp', 'desc'), limit(10));
        const snapshot = await getDocs(q);
        const leaders = snapshot.docs.map((doc, idx) => ({
          rank: idx + 1,
          uid: doc.id,
          xp: doc.data().xp || 0,
          level: doc.data().level || 1,
          nickname: doc.data().nickname || 'ì‚¬ìš©ì'
        }));

        renderLeaderboard(leaders);
      } catch (error) {
        console.error('ë­í‚¹ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    function renderLeaderboard(leaders) {
      if (!leaders.length) {
        leaderboardEmpty.style.display = 'block';
        leaderboardList.innerHTML = '';
        leaderboardTop3.innerHTML = '';
        return;
      }

      leaderboardEmpty.style.display = 'none';
      renderTop3(leaders.slice(0, 3));
      leaderboardList.innerHTML = leaders.map(item => {
        const isMe = currentUser && item.uid === currentUser.uid;
        return `
          <li class="leaderboard-item ${isMe ? 'is-me' : ''}">
            <div class="leaderboard-rank">#${item.rank}</div>
            <div class="leaderboard-user">
              <div class="leaderboard-name">${item.nickname}</div>
              <div class="leaderboard-meta">Lv.${item.level} Â· ${item.xp} XP</div>
            </div>
            ${isMe ? '<span class="leaderboard-badge">ë‚˜</span>' : ''}
          </li>
        `;
      }).join('');
    }

    function renderTop3(top3) {
      if (!top3.length) {
        leaderboardTop3.innerHTML = '';
        return;
      }

      const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
      leaderboardTop3.innerHTML = top3.map((item, idx) => {
        const isMe = currentUser && item.uid === currentUser.uid;
        return `
          <div class="leaderboard-top-card ${isMe ? 'is-me' : ''}">
            <div class="leaderboard-top-medal">${medals[idx] || ''}</div>
            <div class="leaderboard-top-name">${item.nickname}</div>
            <div class="leaderboard-top-meta">Lv.${item.level} Â· ${item.xp} XP</div>
            ${isMe ? '<span class="leaderboard-badge">ë‚˜</span>' : ''}
          </div>
        `;
      }).join('');
    }
  </script>
</body>
</html>
